{% extends "base.html" %} {% load static %}
<link rel="stylesheet" href="{% static '/css/styles.css' %}"/>
{% block title %}Index - Job.it{% endblock %} {% block navbar_extra %}
    <div class="position-absolute top-50 start-50 translate-middle">
        <button type="button" class="btn btn-secondary me-2" onclick="window.location.href='/'">Search Jobs</button>
        <button type="button" class="btn btn-primary" onclick="window.location.href='/worker_profile'">My Profile
        </button>
    </div>
{% endblock %} {% block content %}
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050; display: none;" id="toastContainer">
        <div id="customToast" class="toast align-items-center text-bg-primary border-0 d-flex justify-content-between" role="alert" aria-live="assertive" aria-atomic="true">
            <div id="toastMessage" class="toast-body"></div>
            <button type="button" class="btn-close btn-close-white me-2" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
    <div class="row gutters-sm">
        <div class="col-md-4 mb-3">
            <div class="card shadow p-2">
                <div class="card-body">
                    <div class="d-flex flex-column align-items-center text-center">

                        <div class="profile-img-wrapper position-relative">
                            <img src="{% static 'images/avatar.png' %}" alt="Admin" class="rounded-circle profile-img"
                                 width="150"/>
                            <div class="overlay">
                                <i class="bi bi-camera-fill"></i>
                                <span>Change photo</span>
                            </div>
                        </div>

                        <div class="mt-3">
                            <div class="d-flex align-items-center justify-content-center mb-1">
                                <h4 class="mb-0 me-2">{{ user_data.first_name }} {{ user_data.last_name }}</h4>
                            </div>
                            <div class="d-flex align-items-center justify-content-center mb-1">
                                <div id="positionContent" class="text-secondary mb-0 me-2">{{ user_data.position }}</div>
                                <div id="positionEdit" style="display: none;">
                                    <div class="d-flex flex-column align-items-center">
                                        <input type="text" class="form-control mb-2" id="positionInput" value="{{ user_data.position }}" required>
                                        <div class="invalid-feedback">Position is required</div>
                                        <div class="d-flex gap-3">
                                            <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('position')">Cancel</button>
                                            <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('position')">Save</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex">
                                    <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('position')"></i>
                                </div>
                            </div>

                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <div id="locationContent" class="text-muted font-size-sm mb-0 me-2">{{ user_data.location }}</div>
                                <div id="locationEdit" style="display: none;">
                                    <div class="d-flex flex-column align-items-center">
                                        <input type="text" class="form-control mb-2" id="locationInput" value="{{ user_data.location }}" required>
                                        <div class="invalid-feedback">Location is required</div>
                                        <div class="d-flex gap-3 mb-2">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="remoteCheck" onchange="updateLocationBadges()" {% if user_data.is_remote %}checked{% endif %}>
                                                <label class="form-check-label" for="remoteCheck">
                                                    Remote
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="hybridCheck" onchange="updateLocationBadges()" {% if user_data.is_hybrid %}checked{% endif %}>
                                                <label class="form-check-label" for="hybridCheck">
                                                    Hybrid
                                                </label>
                                            </div>
                                        </div>
                                        <div class="d-flex gap-3">
                                            <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('location')">Cancel</button>
                                            <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('location')">Save</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex">
                                    <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('location')"></i>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <div id="locationBadges" class="d-flex gap-2 mt-1">
                                    {% if user_data.is_remote %}
                                        <span class="badge bg-success" id="remoteBadge">Remote</span>
                                    {% else %}
                                        <span class="badge bg-success" id="remoteBadge" style="display: none;">Remote</span>
                                    {% endif %}
                                    {% if user_data.is_hybrid %}
                                        <span class="badge bg-warning" id="hybridBadge">Hybrid</span>
                                    {% else %}
                                        <span class="badge bg-warning" id="hybridBadge" style="display: none;">Hybrid</span>
                                    {% endif %}
                                </div>
                            </div>
                            <!--
                            <button class="btn btn-primary">Follow</button>
                            <button class="btn btn-outline-primary">Message</button>
                            -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow mt-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Social Links</h6>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#socialLinksModal">
                        <i class="bi bi-pencil"></i> Manage Links
                    </button>
                </div>
                <ul class="list-group list-group-flush" id="socialLinksList">
                </ul>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card shadow mb-3">
                <div class="card-body">
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">First Name</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="firstNameContent">{{ user_data.first_name }}</div>
                            <div id="firstNameEdit" style="display: none;">
                                <input type="text" class="form-control" id="firstNameInput" value="{{ user_data.first_name }}">
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('firstName')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('firstName')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('firstName')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">Last Name</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="lastNameContent">{{ user_data.last_name }}</div>
                            <div id="lastNameEdit" style="display: none;">
                                <input type="text" class="form-control" id="lastNameInput" value="{{ user_data.last_name }}">
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('lastName')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('lastName')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('lastName')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">Email</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="emailContent">{{ user_data.email }}</div>
                            <div id="emailEdit" style="display: none;">
                                <input type="email" class="form-control" id="emailInput" value="{{ user_data.email }}">
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('email')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('email')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('email')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">Mobile</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="mobileContent">{{ user_data.mobile }}</div>
                            <div id="mobileEdit" style="display: none;">
                                <input type="tel" class="form-control" id="mobileInput" value="{{ user_data.mobile }}">
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('mobile')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('mobile')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('mobile')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">Starts in</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="startsInContent">{{ user_data.starts_in }}</div>
                            <div id="startsInEdit" style="display: none;">
                                <select class="form-select" id="startsInSelect">
                                    <option value="ASAP">ASAP</option>
                                    <option value="2 weeks">2 weeks</option>
                                    <option value="1 month">1 month</option>
                                    <option value="3 months">3 months</option>
                                </select>
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('startsIn')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('startsIn')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('startsIn')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row gutters-sm">
                <div class="col-sm-6 mb-3">
                    <div class="card shadow h-100">
                        <div class="card-body">
                            <h6 class="d-flex align-items-center mb-3">
                                <i class="material-icons text-info mr-2">About me</i>
                                <i class="bi bi-pencil ms-auto" style="font-size: 1rem; color: black; cursor: pointer;" 
                                   onclick="toggleAboutMeEdit()"></i>
                            </h6>
                            <div id="aboutMeContent" class="about-me-content">
                                {% if about_me %}
                                    {{ about_me|linebreaks }}
                                {% else %}
                                    Tell something about yourself!
                                {% endif %}
                            </div>
                            <div id="aboutMeEdit" class="about-me-edit" style="display: none;">
                                <textarea class="form-control" id="aboutMeText" rows="8" style="min-height: 200px; resize: vertical;" maxlength="250"></textarea>
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <small class="text-muted" id="charCounter">250 characters remaining</small>
                                </div>
                                <div class="mt-3 d-flex justify-content-end gap-2">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelAboutMeEdit()">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveAboutMe()">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 mb-3">
                    <div class="card shadow h-100">
                        <div class="card-body">
                            <h6 class="d-flex align-items-center mb-3"><i
                                    class="material-icons text-info mr-2">Skills</i></h6>
                            <div id="skillsList">
                                {% for skill in skills %}
                                    <div id="skillItem-{{ skill.id }}">
                                        <div class="d-flex align-items-center">
                                            <small class="w-100 text-truncate">{{ skill.name }}</small>
                                            <i class="bi bi-pencil ms-auto"
                                               style="font-size: 1rem; color: black; cursor: pointer;"
                                               onclick="editSkill('{{ skill.id }}', '{{ skill.level }}', '{{ skill.name }}')"
                                               data-bs-toggle="modal" data-bs-target="#editSkillModal"></i>
                                        </div>
                                        <div class="progress mb-3" style="height: 5px;">
                                            {% if skill.level == 1 %}
                                                <div class="progress-bar bg-success" role="progressbar"
                                                     style="width: 33%;" aria-valuenow="33" aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            {% elif skill.level == 2 %}
                                                <div class="progress-bar bg-warning" role="progressbar"
                                                     style="width: 66%;" aria-valuenow="66" aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            {% else %}
                                                <div class="progress-bar bg-danger" role="progressbar"
                                                     style="width: 100%;" aria-valuenow="100" aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="mb-3 pb-2" style="height: 5px;">
                                <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                                        data-bs-target="#addSkillModal" onclick="fetchSkills(SKILLS_URL)">Add skill <i
                                        class="bi bi-plus-lg"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 mb-3">
                    <div class="card shadow h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="d-flex align-items-center mb-0">
                                    <i class="material-icons text-info mr-2">Projects</i>
                                </h6>
                                <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addProjectModal">
                                    <i class="bi bi-plus-lg"></i> Add Project
                                </button>
                            </div>
                            <div id="projectsList">
                                {% for project in projects %}
                                    <div class="card mb-3 project-card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h5 class="card-title mb-0">{{ project.title }}</h5>
                                                <div class="dropdown">
                                                    <button class="btn btn-link text-dark p-0" type="button" data-bs-toggle="dropdown">
                                                        <i class="bi bi-three-dots-vertical"></i>
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <li><a class="dropdown-item" href="javascript:void(0)" onclick="editProject({{ project.id }})"><i class="bi bi-pencil me-2"></i>Edit</a></li>
                                                        <li><a class="dropdown-item text-danger" href="javascript:void(0)" onclick="deleteProject({{ project.id }})"><i class="bi bi-trash me-2"></i>Delete</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <p class="card-text text-muted">{{ project.description }}</p>
                                            <div class="mb-3">
                                                {% for tech in project.get_technologies %}
                                                    <span class="badge bg-primary me-1">{{ tech }}</span>
                                                {% endfor %}
                                            </div>
                                            <div class="d-flex gap-2">
                                                {% if project.github_link %}
                                                    <a href="{{ project.github_link }}" class="btn btn-outline-primary btn-sm" target="_blank">
                                                        <i class="bi bi-github me-1"></i>GitHub
                                                    </a>
                                                {% endif %}
                                                {% if project.demo_link %}
                                                    <a href="{{ project.demo_link }}" class="btn btn-outline-secondary btn-sm" target="_blank">
                                                        <i class="bi bi-globe me-1"></i>Live Demo
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addSkillModal" tabindex="-1" aria-labelledby="addSkillModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSkillModalLabel">Add New Skill</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="invalid-feedback text-center fs-7" id="skillExistsFeedback">Skill already added.</div>
                    <form id="addSkillForm">
                        <div class="mb-3 position-relative">
                            <label for="searchSkillInput" class="form-label">Skill Name</label>
                            <input type="text" class="form-control" id="searchSkillInput"
                                   placeholder="Type to search..."/>
                            <div class="dropdown" style="position: relative;">
                                <select
                                        class="form-control custom-select-menu"
                                        id="skillNameSelect"
                                        size="5"
                                        style="max-height: 150px; overflow-y: auto; position: absolute; z-index: 1050; display: none; background: white; border: 1px solid #ced4da; width: 100%;"
                                >
                                </select>
                            </div>
                            <div class="invalid-feedback" id="skillNameFeedback">Skill name cannot be empty.</div>
                        </div>
                        <div class="mb-3 position-relative">
                            <label class="form-label">Skill Level</label>
                            <div class="progress position-relative" style="height: 30px; cursor: pointer;">
                                <div class="progress-bar bg-success" id="beginner" role="progressbar"
                                     style="width: 33%;" aria-valuenow="1" aria-valuemin="1" aria-valuemax="3">Beginner
                                </div>
                                <div class="progress-bar bg-warning" id="intermediate" role="progressbar"
                                     style="width: 33%;" aria-valuenow="2" aria-valuemin="1" aria-valuemax="3">
                                    Intermediate
                                </div>
                                <div class="progress-bar bg-danger" id="advanced" role="progressbar" style="width: 34%;"
                                     aria-valuenow="3" aria-valuemin="1" aria-valuemax="3">Advanced
                                </div>
                            </div>
                            <input type="hidden" id="skillLevelSelect" name="skillLevel" value="10"/>
                            <div class="invalid-feedback" id="skillLevelFeedback">Skill level cannot be empty.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="addSkillButton">Add</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editSkillModal" tabindex="-1" aria-labelledby="editSkillModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editSkillModalLabel">Edit Skill</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editSkillForm">
                        <div class="mb-3 position-relative">
                            <label class="form-label">Skill Level</label>
                            <div class="progress position-relative"
                                 style="height: 30px; cursor: pointer;">
                                <div class="progress-bar bg-success" id="beginnerEdit" role="progressbar"
                                     style="width: 33%;" aria-valuenow="1" aria-valuemin="1" aria-valuemax="3">Beginner
                                </div>
                                <div class="progress-bar bg-warning" id="intermediateEdit" role="progressbar"
                                     style="width: 33%;" aria-valuenow="2" aria-valuemin="1" aria-valuemax="3">
                                    Intermediate
                                </div>
                                <div class="progress-bar bg-danger" id="advancedEdit" role="progressbar"
                                     style="width: 34%;" aria-valuenow="3" aria-valuemin="1" aria-valuemax="3">Advanced
                                </div>
                            </div>
                            <input type="hidden" id="skillLevelSelectEdit" name="skillLevel" value="10"/>
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button id="removeSkillButton" type="button" class="btn btn-danger me-auto" data-bs-dismiss="modal">
                        Remove
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSkillButton">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmRemoveSkillModal" tabindex="-1" aria-labelledby="confirmRemoveSkillModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmRemoveSkillModalLabel">Confirm Removal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to remove this skill?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmRemoveButton">Remove</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="profilePhotoModal" tabindex="-1" aria-labelledby="profilePhotoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profilePhotoModalLabel">Change Profile Photo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="dropZone" class="border rounded p-5 text-center mb-3" style="border-style: dashed !important; cursor: pointer;">
                        <i class="bi bi-cloud-upload fs-1 mb-2"></i>
                        <h5>Drag and drop your photo here</h5>
                        <p class="text-muted">or</p>
                        <input type="file" id="fileInput" accept="image/*" style="display: none;">
                        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">Browse Files</button>
                    </div>
                    <div id="previewContainer" class="text-center" style="display: none;">
                        <img id="imagePreview" class="img-fluid rounded mb-3" style="max-height: 200px;">
                        <div class="d-flex justify-content-center gap-2">
                            <button class="btn btn-secondary" onclick="resetUpload()">Cancel</button>
                            <button class="btn btn-primary" onclick="uploadPhoto()">Upload</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="socialLinksModal" tabindex="-1" aria-labelledby="socialLinksModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="socialLinksModalLabel">Manage Social Links</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="socialLinksForm">
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-plus-lg"></i> Add New Link
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSocialLinks()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addProjectModal" tabindex="-1" aria-labelledby="addProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProjectModalLabel">Add New Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addProjectForm">
                        <div class="mb-3">
                            <label for="projectTitle" class="form-label">Project Title</label>
                            <input type="text" class="form-control" id="projectTitle" maxlength="100" required>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <small class="text-muted" id="titleCharCounter">100 characters remaining</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="projectDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="projectDescription" rows="3" maxlength="250" required></textarea>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <small class="text-muted" id="descriptionCharCounter">250 characters remaining</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Technologies</label>
                            <div class="d-flex flex-wrap gap-2" id="technologiesContainer">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Add technology">
                                    <button class="btn btn-outline-secondary" type="button" onclick="addTechnology(this)">
                                        <i class="bi bi-plus-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="technologiesList" class="d-flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        <div class="mb-3">
                            <label for="githubLink" class="form-label">GitHub Link</label>
                            <input type="url" class="form-control" id="githubLink" placeholder="https://github.com/...">
                        </div>
                        <div class="mb-3">
                            <label for="demoLink" class="form-label">Live Demo Link</label>
                            <input type="url" class="form-control" id="demoLink" placeholder="https://...">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProject()">Save Project</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmDeleteProjectModal" tabindex="-1" aria-labelledby="confirmDeleteProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteProjectModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this project?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteProjectButton">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Project Modal -->
    <div class="modal fade" id="editProjectModal" tabindex="-1" aria-labelledby="editProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProjectModalLabel">Edit Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProjectForm">
                        <div class="mb-3">
                            <label for="editProjectTitle" class="form-label">Project Title</label>
                            <input type="text" class="form-control" id="editProjectTitle" maxlength="100" required>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <small class="text-muted" id="editTitleCharCounter">100 characters remaining</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editProjectDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editProjectDescription" rows="3" maxlength="250" required></textarea>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <small class="text-muted" id="editDescriptionCharCounter">250 characters remaining</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Technologies</label>
                            <div class="d-flex flex-wrap gap-2" id="editTechnologiesContainer">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Add technology">
                                    <button class="btn btn-outline-secondary" type="button" onclick="addTechnologyEdit(this)">
                                        <i class="bi bi-plus-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="editTechnologiesList" class="d-flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        <div class="mb-3">
                            <label for="editGithubLink" class="form-label">GitHub Link</label>
                            <input type="url" class="form-control" id="editGithubLink" placeholder="https://github.com/...">
                        </div>
                        <div class="mb-3">
                            <label for="editDemoLink" class="form-label">Live Demo Link</label>
                            <input type="url" class="form-control" id="editDemoLink" placeholder="https://...">
                        </div>
                        <input type="hidden" id="editProjectId">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateProject()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .project-card {
            transition: transform 0.2s ease-in-out;
        }
        .project-card:hover {
            transform: translateY(-5px);
        }
        .technology-badge {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .technology-badge:hover {
            opacity: 0.8;
        }
    </style>

    <script src="{% static 'js/worker-profile-add-skill-modal.js' %}"></script>
    <script src="{% static 'js/worker-profile-edit-skill.js' %}"></script>
    <script src="{% static 'js/worker-profile-common.js' %}"></script>
    <script src="{% static 'js/worker-profile-edit-about-me.js' %}"></script>
    <script src="{% static 'js/worker-profile-social-links.js' %}"></script>
    <script>
        function updateLocationBadges() {
            const remoteCheck = document.getElementById('remoteCheck');
            const hybridCheck = document.getElementById('hybridCheck');
            const remoteBadge = document.getElementById('remoteBadge');
            const hybridBadge = document.getElementById('hybridBadge');
            const locationBadges = document.getElementById('locationBadges');

            locationBadges.style.display = 'flex';
            
            if (remoteCheck.checked) {
                remoteBadge.style.display = 'inline-block';
                remoteBadge.style.visibility = 'visible';
            } else {
                remoteBadge.style.display = 'none';
                remoteBadge.style.visibility = 'hidden';
            }
            
            if (hybridCheck.checked) {
                hybridBadge.style.display = 'inline-block';
                hybridBadge.style.visibility = 'visible';
            } else {
                hybridBadge.style.display = 'none';
                hybridBadge.style.visibility = 'hidden';
            }
        }

        function toggleEdit(field) {
            const contentDiv = document.getElementById(`${field}Content`);
            const editDiv = document.getElementById(`${field}Edit`);
            const editIcon = contentDiv.closest('.d-flex').querySelector('.edit-icon');
            const editButtons = editIcon.nextElementSibling;
            
            if (contentDiv.style.display !== 'none') {
                contentDiv.style.display = 'none';
                editDiv.style.display = 'block';
                editIcon.classList.add('d-none');
                editButtons.classList.remove('d-none');
                
                const input = editDiv.querySelector('input, select');
                if (input) {
                    input.value = contentDiv.textContent.trim();
                }

                if (field === 'location') {
                    const remoteCheck = document.getElementById('remoteCheck');
                    const hybridCheck = document.getElementById('hybridCheck');
                    const remoteBadge = document.getElementById('remoteBadge');
                    const hybridBadge = document.getElementById('hybridBadge');

                    remoteCheck.checked = remoteBadge.style.display !== 'none';
                    hybridCheck.checked = hybridBadge.style.display !== 'none';
                    updateLocationBadges();
                }
            } else {
                contentDiv.style.display = 'block';
                editDiv.style.display = 'none';
                editIcon.classList.remove('d-none');
                editButtons.classList.add('d-none');
            }
        }

        function cancelEdit(field) {
            const contentDiv = document.getElementById(`${field}Content`);
            const editDiv = document.getElementById(`${field}Edit`);
            const editIcon = contentDiv.closest('.d-flex').querySelector('.edit-icon');
            const editButtons = editIcon.nextElementSibling;
            
            contentDiv.style.display = 'block';
            editDiv.style.display = 'none';
            editIcon.classList.remove('d-none');
            editButtons.classList.add('d-none');

            if (field === 'location') {
                const remoteCheck = document.getElementById('remoteCheck');
                const hybridCheck = document.getElementById('hybridCheck');
                const remoteBadge = document.getElementById('remoteBadge');
                const hybridBadge = document.getElementById('hybridBadge');

                remoteCheck.checked = remoteBadge.style.display !== 'none';
                hybridCheck.checked = hybridBadge.style.display !== 'none';
                updateLocationBadges();
            }
        }

        function showToast(message, isSuccess = true) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.getElementById('customToast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastContainer.style.display = 'block';
            toast.className = `toast align-items-center text-bg-${isSuccess ? 'success' : 'danger'} border-0 d-flex justify-content-between`;
            toastMessage.textContent = message;
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            toast.addEventListener('hidden.bs.toast', function () {
                toastContainer.style.display = 'none';
            });
        }

        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 9) value = value.slice(0, 9);
            if (value.length > 6) {
                value = value.slice(0, 6) + ' ' + value.slice(6);
            }
            if (value.length > 3) {
                value = value.slice(0, 3) + ' ' + value.slice(3);
            }
            input.value = value;
        }

        function validatePhoneNumber(value) {
            return /^\d{3} \d{3} \d{3}$/.test(value);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const mobileInput = document.getElementById('mobileInput');
            if (mobileInput) {
                mobileInput.addEventListener('input', function() {
                    formatPhoneNumber(this);
                });
            }
        });

        async function saveEdit(field) {
            const contentDiv = document.getElementById(`${field}Content`);
            const editDiv = document.getElementById(`${field}Edit`);
            const editIcon = contentDiv.closest('.d-flex').querySelector('.edit-icon');
            const editButtons = editIcon.nextElementSibling;
            const input = editDiv.querySelector('input, select');
            
            if (input) {
                const value = input.value.trim();
                if (!value) {
                    showToast('Field cannot be empty', false);
                    return;
                }

                if (field === 'startsIn') {
                    try {
                        const response = await fetch('/update_starts_in', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': CSRF_TOKEN
                            },
                            body: JSON.stringify({
                                starts_in: value
                            })
                        });

                        const data = await response.json();
                        
                        if (response.ok) {
                            contentDiv.textContent = value;
                            contentDiv.style.display = 'block';
                            editDiv.style.display = 'none';
                            editIcon.classList.remove('d-none');
                            editButtons.classList.add('d-none');
                            
                            showToast('Starts in updated successfully');
                        } else {
                            showToast(data.error || 'Failed to update starts in', false);
                        }
                    } catch (error) {
                        showToast('An error occurred while updating starts in', false);
                    }
                } else if (field === 'mobile') {
                    if (!validatePhoneNumber(value)) {
                        showToast('Phone number must be in format: xxx xxx xxx', false);
                        return;
                    }

                    try {
                        const response = await fetch('/update_mobile', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': CSRF_TOKEN
                            },
                            body: JSON.stringify({
                                mobile: value
                            })
                        });

                        const data = await response.json();
                        
                        if (response.ok) {
                            contentDiv.textContent = value;
                            contentDiv.style.display = 'block';
                            editDiv.style.display = 'none';
                            editIcon.classList.remove('d-none');
                            editButtons.classList.add('d-none');
                            
                            showToast('Mobile number updated successfully');
                        } else {
                            showToast(data.error || 'Failed to update mobile number', false);
                        }
                    } catch (error) {
                        showToast('An error occurred while updating mobile number', false);
                    }
                } else if (field === 'firstName' || field === 'lastName') {
                    try {
                        const endpoint = field === 'firstName' ? '/update_first_name' : '/update_last_name';
                        const response = await fetch(endpoint, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': CSRF_TOKEN
                            },
                            body: JSON.stringify({
                                [field === 'firstName' ? 'first_name' : 'last_name']: value
                            })
                        });

                        const data = await response.json();
                        
                        if (response.ok) {
                            contentDiv.textContent = value;
                            contentDiv.style.display = 'block';
                            editDiv.style.display = 'none';
                            editIcon.classList.remove('d-none');
                            editButtons.classList.add('d-none');
                            
                            // Update name under profile photo
                            const profileName = document.querySelector('.profile-img-wrapper').nextElementSibling.querySelector('h4');
                            const firstName = document.getElementById('firstNameContent').textContent;
                            const lastName = document.getElementById('lastNameContent').textContent;
                            profileName.textContent = `${firstName} ${lastName}`;
                            
                            showToast(`${field === 'firstName' ? 'First' : 'Last'} name updated successfully`);
                        } else {
                            showToast(data.error || `Failed to update ${field === 'firstName' ? 'first' : 'last'} name`, false);
                        }
                    } catch (error) {
                        showToast(`An error occurred while updating ${field === 'firstName' ? 'first' : 'last'} name`, false);
                    }
                } else if (field === 'email') {
                    try {
                        const response = await fetch('/update_email', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': CSRF_TOKEN
                            },
                            body: JSON.stringify({
                                email: value
                            })
                        });

                        const data = await response.json();
                        
                        if (response.ok) {
                            contentDiv.textContent = value;
                            contentDiv.style.display = 'block';
                            editDiv.style.display = 'none';
                            editIcon.classList.remove('d-none');
                            editButtons.classList.add('d-none');
                            
                            showToast('Email updated successfully');
                        } else {
                            showToast(data.error || 'Failed to update email', false);
                        }
                    } catch (error) {
                        showToast('An error occurred while updating email', false);
                    }
                } else if (field === 'position') {
                    try {
                        const response = await fetch('/update-position', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': CSRF_TOKEN
                            },
                            body: JSON.stringify({
                                position: value
                            })
                        });

                        const data = await response.json();
                        
                        if (response.ok) {
                            contentDiv.textContent = value;
                            contentDiv.style.display = 'block';
                            editDiv.style.display = 'none';
                            editIcon.classList.remove('d-none');
                            editButtons.classList.add('d-none');
                            
                            showToast('Position updated successfully');
                        } else {
                            showToast(data.error || 'Failed to update position', false);
                        }
                    } catch (error) {
                        showToast('An error occurred while updating position', false);
                    }
                } else if (field === 'location') {
                    try {
                        const locationInput = document.getElementById('locationInput');
                        const remoteCheck = document.getElementById('remoteCheck');
                        const hybridCheck = document.getElementById('hybridCheck');

                        const response = await fetch('/update-location', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': CSRF_TOKEN
                            },
                            body: JSON.stringify({
                                location: locationInput.value.trim(),
                                is_remote: remoteCheck.checked,
                                is_hybrid: hybridCheck.checked
                            })
                        });

                        const data = await response.json();
                        
                        if (response.ok) {
                            contentDiv.textContent = locationInput.value.trim();
                            contentDiv.style.display = 'block';
                            editDiv.style.display = 'none';
                            editIcon.classList.remove('d-none');
                            editButtons.classList.add('d-none');
                            
                            updateLocationBadges();
                            showToast('Location updated successfully');
                        } else {
                            showToast(data.error || 'Failed to update location', false);
                        }
                    } catch (error) {
                        showToast('An error occurred while updating location', false);
                    }
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const remoteCheck = document.getElementById('remoteCheck');
            const hybridCheck = document.getElementById('hybridCheck');
            if (remoteCheck && hybridCheck) {
                updateLocationBadges();
            }

            // Set initial value for startsIn select
            const startsInSelect = document.getElementById('startsInSelect');
            const startsInContent = document.getElementById('startsInContent');
            if (startsInSelect && startsInContent) {
                startsInSelect.value = startsInContent.textContent.trim();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const profileImg = document.querySelector('.profile-img');
            const overlay = document.querySelector('.overlay');

            profileImg.parentElement.addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('profilePhotoModal'));
                modal.show();
            });

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                dropZone.classList.add('bg-light');
            }

            function unhighlight(e) {
                dropZone.classList.remove('bg-light');
            }

            dropZone.addEventListener('drop', handleDrop, false);
            fileInput.addEventListener('change', handleFileSelect, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            function handleFileSelect(e) {
                const files = e.target.files;
                handleFiles(files);
            }

            function handleFiles(files) {
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('imagePreview').src = e.target.result;
                            document.getElementById('previewContainer').style.display = 'block';
                            dropZone.style.display = 'none';
                        }
                        reader.readAsDataURL(file);
                    } else {
                        alert('Please select an image file.');
                    }
                }
            }
        });

        function resetUpload() {
            document.getElementById('fileInput').value = '';
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('dropZone').style.display = 'block';
        }

        function uploadPhoto() {
            // TODO: Upload photo to server
            const preview = document.getElementById('imagePreview');
            const profileImg = document.querySelector('.profile-img');
            profileImg.src = preview.src;
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('profilePhotoModal'));
            modal.hide();
            
            resetUpload();
        }

        let projects = [
            {% for project in projects %}
            {
                id: {{ project.id }},
                title: "{{ project.title }}",
                description: "{{ project.description }}",
                technologies: {{ project.get_technologies|safe }},
                githubLink: "{{ project.github_link|default:'' }}",
                demoLink: "{{ project.demo_link|default:'' }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];
        let technologies = new Set();
        let projectToDelete = null;

        function addTechnology(button) {
            const input = button.previousElementSibling;
            const technology = input.value.trim();
            
            if (technology && !technologies.has(technology)) {
                technologies.add(technology);
                const badge = document.createElement('span');
                badge.className = 'badge bg-primary technology-badge me-1';
                badge.textContent = technology;
                badge.onclick = () => {
                    technologies.delete(technology);
                    badge.remove();
                };
                document.getElementById('technologiesList').appendChild(badge);
                input.value = '';
            }
        }

        async function saveProject() {
            const title = document.getElementById('projectTitle').value;
            const description = document.getElementById('projectDescription').value;
            const githubLink = document.getElementById('githubLink').value;
            const demoLink = document.getElementById('demoLink').value;
            
            if (!title || !description) {
                showToast('Please fill in all required fields', false);
                return;
            }

            const projectData = {
                title,
                description,
                technologies: Array.from(technologies),
                github_link: githubLink,
                demo_link: demoLink,
                order: projects.length // Set order based on current number of projects
            };

            try {
                const response = await fetch('/projects/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': CSRF_TOKEN
                    },
                    body: JSON.stringify(projectData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    // Add the new project to the list
                    projects.push({
                        id: data.id,
                        title: data.title,
                        description: data.description,
                        technologies: data.technologies,
                        githubLink: data.github_link,
                        demoLink: data.demo_link
                    });
                    
                    renderProjects();
                    
                    // Reset form
                    document.getElementById('addProjectForm').reset();
                    technologies.clear();
                    document.getElementById('technologiesList').innerHTML = '';
                    document.getElementById('titleCharCounter').textContent = '100 characters remaining';
                    document.getElementById('descriptionCharCounter').textContent = '250 characters remaining';
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addProjectModal'));
                    modal.hide();
                    
                    showToast('Project added successfully');
                } else {
                    showToast(data.error || 'Failed to add project', false);
                }
            } catch (error) {
                console.error('Error adding project:', error);
                showToast('An error occurred while adding the project', false);
            }
        }

        // Add character counter event listeners for project title and description
        document.getElementById('projectTitle').addEventListener('input', function() {
            const maxLength = 100;
            const remaining = maxLength - this.value.length;
            document.getElementById('titleCharCounter').textContent = `${remaining} characters remaining`;
        });

        document.getElementById('projectDescription').addEventListener('input', function() {
            const maxLength = 250;
            const remaining = maxLength - this.value.length;
            document.getElementById('descriptionCharCounter').textContent = `${remaining} characters remaining`;
        });

        function renderProjects() {
            const container = document.getElementById('projectsList');
            container.innerHTML = '';
            
            projects.forEach(project => {
                const projectCard = document.createElement('div');
                projectCard.className = 'card mb-3 project-card';
                projectCard.innerHTML = `
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title mb-0">${project.title}</h5>
                            <div class="dropdown">
                                <button class="btn btn-link text-dark p-0" type="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="editProject(${project.id})"><i class="bi bi-pencil me-2"></i>Edit</a></li>
                                    <li><a class="dropdown-item text-danger" href="javascript:void(0)" onclick="deleteProject(${project.id})"><i class="bi bi-trash me-2"></i>Delete</a></li>
                                </ul>
                            </div>
                        </div>
                        <p class="card-text text-muted">${project.description}</p>
                        <div class="mb-3">
                            ${project.technologies.map(tech => `<span class="badge bg-primary me-1">${tech}</span>`).join('')}
                        </div>
                        <div class="d-flex gap-2">
                            ${project.githubLink ? `
                                <a href="${project.githubLink}" class="btn btn-outline-primary btn-sm" target="_blank">
                                    <i class="bi bi-github me-1"></i>GitHub
                                </a>
                            ` : ''}
                            ${project.demoLink ? `
                                <a href="${project.demoLink}" class="btn btn-outline-secondary btn-sm" target="_blank">
                                    <i class="bi bi-globe me-1"></i>Live Demo
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(projectCard);
            });
        }

        let editTechnologies = new Set();

        function editProject(id) {
            const project = projects.find(p => p.id === id);
            if (!project) return;

            document.getElementById('editProjectId').value = project.id;
            document.getElementById('editProjectTitle').value = project.title;
            document.getElementById('editProjectDescription').value = project.description;
            document.getElementById('editGithubLink').value = project.githubLink || '';
            document.getElementById('editDemoLink').value = project.demoLink || '';
            
            const titleRemaining = 100 - project.title.length;
            const descriptionRemaining = 250 - project.description.length;
            document.getElementById('editTitleCharCounter').textContent = `${titleRemaining} characters remaining`;
            document.getElementById('editDescriptionCharCounter').textContent = `${descriptionRemaining} characters remaining`;
            
            // Clear existing technologies
            document.getElementById('editTechnologiesList').innerHTML = '';
            editTechnologies = new Set(project.technologies);
            
            // Add existing technologies
            project.technologies.forEach(tech => {
                editTechnologies.add(tech);
                const badge = document.createElement('span');
                badge.className = 'badge bg-primary technology-badge me-1';
                badge.textContent = tech;
                badge.onclick = () => {
                    editTechnologies.delete(tech);
                    badge.remove();
                };
                document.getElementById('editTechnologiesList').appendChild(badge);
            });

            const modal = new bootstrap.Modal(document.getElementById('editProjectModal'));
            modal.show();
        }

        function addTechnologyEdit(button) {
            const input = button.previousElementSibling;
            const technology = input.value.trim();
            
            if (technology && !editTechnologies.has(technology)) {
                editTechnologies.add(technology);
                const badge = document.createElement('span');
                badge.className = 'badge bg-primary technology-badge me-1';
                badge.textContent = technology;
                badge.onclick = () => {
                    editTechnologies.delete(technology);
                    badge.remove();
                };
                document.getElementById('editTechnologiesList').appendChild(badge);
                input.value = '';
            }
        }

        function updateProject() {
            const id = parseInt(document.getElementById('editProjectId').value);
            const title = document.getElementById('editProjectTitle').value.trim();
            const description = document.getElementById('editProjectDescription').value.trim();
            const githubLink = document.getElementById('editGithubLink').value.trim();
            const demoLink = document.getElementById('editDemoLink').value.trim();
            
            if (!title || !description) {
                showToast('Please fill in all required fields', false);
                return;
            }

            const projectData = {
                title,
                description,
                technologies: Array.from(editTechnologies),
                githubLink: githubLink || null,
                demoLink: demoLink || null
            };

            fetch(`/projects/update/${id}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify(projectData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showToast(data.error, false);
                } else {
                    // Update the project in the local array
                    const index = projects.findIndex(p => p.id === id);
                    if (index !== -1) {
                        projects[index] = {
                            id,
                            title: data.project.title,
                            description: data.project.description,
                            technologies: data.project.technologies,
                            githubLink: data.project.github_link,
                            demoLink: data.project.demo_link
                        };
                    }
                    
                    // Update the UI
                    renderProjects();
                    showToast('Project updated successfully');
                    
                    // Close the modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('editProjectModal'));
                    modal.hide();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Failed to update project', false);
            });
        }

        document.getElementById('editProjectTitle').addEventListener('input', function() {
            const maxLength = 100;
            const remaining = maxLength - this.value.length;
            document.getElementById('editTitleCharCounter').textContent = `${remaining} characters remaining`;
        });

        document.getElementById('editProjectDescription').addEventListener('input', function() {
            const maxLength = 250;
            const remaining = maxLength - this.value.length;
            document.getElementById('editDescriptionCharCounter').textContent = `${remaining} characters remaining`;
        });

        function deleteProject(id) {
            projectToDelete = id;
            const modal = new bootstrap.Modal(document.getElementById('confirmDeleteProjectModal'));
            modal.show();
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('confirmDeleteProjectButton').addEventListener('click', async function() {
                if (projectToDelete !== null) {
                    try {
                        const response = await fetch(`/projects/delete/${projectToDelete}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': CSRF_TOKEN
                            }
                        });

                        const data = await response.json();
                        
                        if (response.ok) {
                            projects = projects.filter(p => p.id !== projectToDelete);
                            renderProjects();
                            
                            const modal = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteProjectModal'));
                            modal.hide();
                            
                            showToast('Project deleted successfully');
                        } else {
                            showToast(data.error || 'Failed to delete project', false);
                        }
                    } catch (error) {
                        showToast('An error occurred while deleting the project', false);
                    }
                    projectToDelete = null;
                }
            });

            const remoteCheck = document.getElementById('remoteCheck');
            const hybridCheck = document.getElementById('hybridCheck');
            if (remoteCheck && hybridCheck) {
                updateLocationBadges();
            }

            // Set initial value for startsIn select
            const startsInSelect = document.getElementById('startsInSelect');
            const startsInContent = document.getElementById('startsInContent');
            if (startsInSelect && startsInContent) {
                startsInSelect.value = startsInContent.textContent.trim();
            }
        });

    </script>
{% endblock %}
