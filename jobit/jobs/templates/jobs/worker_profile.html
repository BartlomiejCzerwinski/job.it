{% extends "base.html" %} {% load static %}
<link rel="stylesheet" href="{% static '/css/styles.css' %}"/>
{% block title %}Index - Job.it{% endblock %} {% block navbar_extra %}
    <div class="position-absolute top-50 start-50 translate-middle">
        <button type="button" class="btn btn-secondary me-2" onclick="window.location.href='/'">Search Jobs</button>
        <button type="button" class="btn btn-primary" onclick="window.location.href='/worker_profile'">My Profile
        </button>
    </div>
{% endblock %} {% block content %}
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050; display: none;" id="toastContainer">
        <div id="customToast" class="toast align-items-center text-bg-primary border-0 d-flex justify-content-between" role="alert" aria-live="assertive" aria-atomic="true">
            <div id="toastMessage" class="toast-body"></div>
            <button type="button" class="btn-close btn-close-white me-2" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
    <div class="row gutters-sm">
        <div class="col-md-4 mb-3">
            <div class="card shadow p-2">
                <div class="card-body">
                    <div class="d-flex flex-column align-items-center text-center">

                        <div class="profile-img-wrapper position-relative">
                            <img src="{% static 'images/avatar.png' %}" alt="Admin" class="rounded-circle profile-img"
                                 width="150"/>
                            <div class="overlay">
                                <i class="bi bi-camera-fill"></i>
                                <span>Change photo</span>
                            </div>
                        </div>

                        <div class="mt-3">
                            <div class="d-flex align-items-center justify-content-center mb-1">
                                <h4 class="mb-0 me-2">{{ user_data.first_name }} {{ user_data.last_name }}</h4>
                            </div>
                            <div class="d-flex align-items-center justify-content-center mb-1">
                                <div id="positionContent" class="text-secondary mb-0 me-2">{{ user_data.position }}</div>
                                <div id="positionEdit" style="display: none;">
                                    <div class="d-flex flex-column align-items-center">
                                        <input type="text" class="form-control mb-2" id="positionInput" value="{{ user_data.position }}" required>
                                        <div class="invalid-feedback">Position is required</div>
                                        <div class="d-flex gap-3">
                                            <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('position')">Cancel</button>
                                            <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('position')">Save</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex">
                                    <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('position')"></i>
                                </div>
                            </div>

                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <div id="locationContent" class="text-muted font-size-sm mb-0 me-2">{{ user_data.location }}</div>
                                <div id="locationEdit" style="display: none;">
                                    <div class="d-flex flex-column align-items-center">
                                        <select class="form-select mb-2" id="countrySelect" required>
                                            <option value="">{{ user_data.country|escapejs }}</option>
                                        </select>
                                        <select class="form-select mb-2" id="citySelect" required>
                                            <option value="">{{ user_data.city|escapejs }}</option>
                                        </select>
                                        <div class="invalid-feedback">Location is required</div>
                                        <div class="d-flex gap-3 mb-2">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="remoteCheck" onchange="updateLocationBadges()" {% if user_data.is_remote %}checked{% endif %}>
                                                <label class="form-check-label" for="remoteCheck">
                                                    Remote
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="hybridCheck" onchange="updateLocationBadges()" {% if user_data.is_hybrid %}checked{% endif %}>
                                                <label class="form-check-label" for="hybridCheck">
                                                    Hybrid
                                                </label>
                                            </div>
                                        </div>
                                        <div class="d-flex gap-3">
                                            <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('location')">Cancel</button>
                                            <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('location')">Save</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex">
                                    <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('location')"></i>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <div id="locationBadges" class="d-flex gap-2 mt-1">
                                    {% if user_data.is_remote %}
                                        <span class="badge bg-success" id="remoteBadge">Remote</span>
                                    {% else %}
                                        <span class="badge bg-success" id="remoteBadge" style="display: none;">Remote</span>
                                    {% endif %}
                                    {% if user_data.is_hybrid %}
                                        <span class="badge bg-warning" id="hybridBadge">Hybrid</span>
                                    {% else %}
                                        <span class="badge bg-warning" id="hybridBadge" style="display: none;">Hybrid</span>
                                    {% endif %}
                                </div>
                            </div>
                            <!--
                            <button class="btn btn-primary">Follow</button>
                            <button class="btn btn-outline-primary">Message</button>
                            -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow mt-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">Social Links</h6>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#socialLinksModal">
                        <i class="bi bi-pencil"></i> Manage Links
                    </button>
                </div>
                <ul class="list-group list-group-flush" id="socialLinksList">
                </ul>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card shadow mb-3">
                <div class="card-body">
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">First Name</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="firstNameContent">{{ user_data.first_name }}</div>
                            <div id="firstNameEdit" style="display: none;">
                                <input type="text" class="form-control" id="firstNameInput" value="{{ user_data.first_name }}">
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('firstName')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('firstName')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('firstName')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">Last Name</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="lastNameContent">{{ user_data.last_name }}</div>
                            <div id="lastNameEdit" style="display: none;">
                                <input type="text" class="form-control" id="lastNameInput" value="{{ user_data.last_name }}">
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('lastName')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('lastName')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('lastName')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">Email</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="emailContent">{{ user_data.email }}</div>
                            <div id="emailEdit" style="display: none;">
                                <input type="email" class="form-control" id="emailInput" value="{{ user_data.email }}">
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('email')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('email')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('email')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">Mobile</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="mobileContent">{{ user_data.mobile }}</div>
                            <div id="mobileEdit" style="display: none;">
                                <input type="tel" class="form-control" id="mobileInput" value="{{ user_data.mobile }}">
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('mobile')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('mobile')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('mobile')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <div class="row align-items-center mb-2">
                        <div class="col-sm-3">
                            <h6 class="mb-0">Starts in</h6>
                        </div>
                        <div class="col-sm-9 text-secondary d-flex justify-content-between">
                            <div id="startsInContent">{{ user_data.starts_in }}</div>
                            <div id="startsInEdit" style="display: none;">
                                <select class="form-select" id="startsInSelect">
                                    <option value="ASAP">ASAP</option>
                                    <option value="2 weeks">2 weeks</option>
                                    <option value="1 month">1 month</option>
                                    <option value="3 months">3 months</option>
                                </select>
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-pencil edit-icon" style="font-size: 1rem; color: black; cursor: pointer;" onclick="toggleEdit('startsIn')"></i>
                                <div class="edit-buttons d-flex gap-3 d-none">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelEdit('startsIn')">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveEdit('startsIn')">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row gutters-sm">
                <div class="col-sm-6 mb-3">
                    <div class="card shadow h-100">
                        <div class="card-body">
                            <h6 class="d-flex align-items-center mb-3">
                                <i class="material-icons text-info mr-2">About me</i>
                                <i class="bi bi-pencil ms-auto" style="font-size: 1rem; color: black; cursor: pointer;" 
                                   onclick="toggleAboutMeEdit()"></i>
                            </h6>
                            <div id="aboutMeContent" class="about-me-content">
                                {% if about_me %}
                                    {{ about_me|linebreaks }}
                                {% else %}
                                    Tell something about yourself!
                                {% endif %}
                            </div>
                            <div id="aboutMeEdit" class="about-me-edit" style="display: none;">
                                <textarea class="form-control" id="aboutMeText" rows="8" style="min-height: 200px; resize: vertical;" maxlength="250"></textarea>
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <small class="text-muted" id="charCounter">250 characters remaining</small>
                                </div>
                                <div class="mt-3 d-flex justify-content-end gap-2">
                                    <button type="button" class="btn btn-secondary btn-sm" onclick="cancelAboutMeEdit()">Cancel</button>
                                    <button type="button" class="btn btn-primary btn-sm" onclick="saveAboutMe()">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 mb-3">
                    <div class="card shadow h-100">
                        <div class="card-body">
                            <h6 class="d-flex align-items-center mb-3"><i
                                    class="material-icons text-info mr-2">Skills</i></h6>
                            <div id="skillsList">
                                {% for skill in skills %}
                                    <div id="skillItem-{{ skill.id }}">
                                        <div class="d-flex align-items-center">
                                            <small class="w-100 text-truncate">{{ skill.name }}</small>
                                            <i class="bi bi-pencil ms-auto"
                                               style="font-size: 1rem; color: black; cursor: pointer;"
                                               onclick="editSkill('{{ skill.id }}', '{{ skill.level }}', '{{ skill.name }}')"
                                               data-bs-toggle="modal" data-bs-target="#editSkillModal"></i>
                                        </div>
                                        <div class="progress mb-3" style="height: 5px;">
                                            {% if skill.level == 1 %}
                                                <div class="progress-bar bg-success" role="progressbar"
                                                     style="width: 33%;" aria-valuenow="33" aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            {% elif skill.level == 2 %}
                                                <div class="progress-bar bg-warning" role="progressbar"
                                                     style="width: 66%;" aria-valuenow="66" aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            {% else %}
                                                <div class="progress-bar bg-danger" role="progressbar"
                                                     style="width: 100%;" aria-valuenow="100" aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="mb-3 pb-2" style="height: 5px;">
                                <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                                        data-bs-target="#addSkillModal" onclick="fetchSkills(SKILLS_URL)">Add skill <i
                                        class="bi bi-plus-lg"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 mb-3">
                    <div class="card shadow h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="d-flex align-items-center mb-0">
                                    <i class="material-icons text-info mr-2">Projects</i>
                                </h6>
                                <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addProjectModal">
                                    <i class="bi bi-plus-lg"></i> Add Project
                                </button>
                            </div>
                            <div id="projectsList">
                                {% for project in projects %}
                                    <div class="card mb-3 project-card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h5 class="card-title mb-0">{{ project.title }}</h5>
                                                <div class="dropdown">
                                                    <button class="btn btn-link text-dark p-0" type="button" data-bs-toggle="dropdown">
                                                        <i class="bi bi-three-dots-vertical"></i>
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <li><a class="dropdown-item" href="javascript:void(0)" onclick="editProject({{ project.id }})"><i class="bi bi-pencil me-2"></i>Edit</a></li>
                                                        <li><a class="dropdown-item text-danger" href="javascript:void(0)" onclick="deleteProject({{ project.id }})"><i class="bi bi-trash me-2"></i>Delete</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <p class="card-text text-muted">{{ project.description }}</p>
                                            <div class="mb-3">
                                                {% for tech in project.get_technologies %}
                                                    <span class="badge bg-primary me-1">{{ tech }}</span>
                                                {% endfor %}
                                            </div>
                                            <div class="d-flex gap-2">
                                                {% if project.github_link %}
                                                    <a href="{{ project.github_link }}" class="btn btn-outline-primary btn-sm" target="_blank">
                                                        <i class="bi bi-github me-1"></i>GitHub
                                                    </a>
                                                {% endif %}
                                                {% if project.demo_link %}
                                                    <a href="{{ project.demo_link }}" class="btn btn-outline-secondary btn-sm" target="_blank">
                                                        <i class="bi bi-globe me-1"></i>Live Demo
                                                    </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addSkillModal" tabindex="-1" aria-labelledby="addSkillModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSkillModalLabel">Add New Skill</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="invalid-feedback text-center fs-7" id="skillExistsFeedback">Skill already added.</div>
                    <form id="addSkillForm">
                        <div class="mb-3 position-relative">
                            <label for="searchSkillInput" class="form-label">Skill Name</label>
                            <input type="text" class="form-control" id="searchSkillInput"
                                   placeholder="Type to search..."/>
                            <div class="dropdown" style="position: relative;">
                                <select
                                        class="form-control custom-select-menu"
                                        id="skillNameSelect"
                                        size="5"
                                        style="max-height: 150px; overflow-y: auto; position: absolute; z-index: 1050; display: none; background: white; border: 1px solid #ced4da; width: 100%;"
                                >
                                </select>
                            </div>
                            <div class="invalid-feedback" id="skillNameFeedback">Skill name cannot be empty.</div>
                        </div>
                        <div class="mb-3 position-relative">
                            <label class="form-label">Skill Level</label>
                            <div class="progress position-relative" style="height: 30px; cursor: pointer;">
                                <div class="progress-bar bg-success" id="beginner" role="progressbar"
                                     style="width: 33%;" aria-valuenow="1" aria-valuemin="1" aria-valuemax="3">Beginner
                                </div>
                                <div class="progress-bar bg-warning" id="intermediate" role="progressbar"
                                     style="width: 33%;" aria-valuenow="2" aria-valuemin="1" aria-valuemax="3">
                                    Intermediate
                                </div>
                                <div class="progress-bar bg-danger" id="advanced" role="progressbar" style="width: 34%;"
                                     aria-valuenow="3" aria-valuemin="1" aria-valuemax="3">Advanced
                                </div>
                            </div>
                            <input type="hidden" id="skillLevelSelect" name="skillLevel" value="10"/>
                            <div class="invalid-feedback" id="skillLevelFeedback">Skill level cannot be empty.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="addSkillButton">Add</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editSkillModal" tabindex="-1" aria-labelledby="editSkillModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editSkillModalLabel">Edit Skill</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editSkillForm">
                        <div class="mb-3 position-relative">
                            <label class="form-label">Skill Level</label>
                            <div class="progress position-relative"
                                 style="height: 30px; cursor: pointer;">
                                <div class="progress-bar bg-success" id="beginnerEdit" role="progressbar"
                                     style="width: 33%;" aria-valuenow="1" aria-valuemin="1" aria-valuemax="3">Beginner
                                </div>
                                <div class="progress-bar bg-warning" id="intermediateEdit" role="progressbar"
                                     style="width: 33%;" aria-valuenow="2" aria-valuemin="1" aria-valuemax="3">
                                    Intermediate
                                </div>
                                <div class="progress-bar bg-danger" id="advancedEdit" role="progressbar"
                                     style="width: 34%;" aria-valuenow="3" aria-valuemin="1" aria-valuemax="3">Advanced
                                </div>
                            </div>
                            <input type="hidden" id="skillLevelSelectEdit" name="skillLevel" value="10"/>
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button id="removeSkillButton" type="button" class="btn btn-danger me-auto" data-bs-dismiss="modal">
                        Remove
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSkillButton">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmRemoveSkillModal" tabindex="-1" aria-labelledby="confirmRemoveSkillModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmRemoveSkillModalLabel">Confirm Removal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to remove this skill?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmRemoveButton">Remove</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="profilePhotoModal" tabindex="-1" aria-labelledby="profilePhotoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profilePhotoModalLabel">Change Profile Photo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="dropZone" class="border rounded p-5 text-center mb-3" style="border-style: dashed !important; cursor: pointer;">
                        <i class="bi bi-cloud-upload fs-1 mb-2"></i>
                        <h5>Drag and drop your photo here</h5>
                        <p class="text-muted">or</p>
                        <input type="file" id="fileInput" accept="image/*" style="display: none;">
                        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">Browse Files</button>
                    </div>
                    <div id="previewContainer" class="text-center" style="display: none;">
                        <img id="imagePreview" class="img-fluid rounded mb-3" style="max-height: 200px;">
                        <div class="d-flex justify-content-center gap-2">
                            <button class="btn btn-secondary" onclick="resetUpload()">Cancel</button>
                            <button class="btn btn-primary" onclick="uploadPhoto()">Upload</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger me-auto" onclick="removeProfilePhoto()">Remove Photo</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="socialLinksModal" tabindex="-1" aria-labelledby="socialLinksModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="socialLinksModalLabel">Manage Social Links</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="socialLinksForm">
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-plus-lg"></i> Add New Link
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSocialLinks()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addProjectModal" tabindex="-1" aria-labelledby="addProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProjectModalLabel">Add New Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addProjectForm">
                        <div class="mb-3">
                            <label for="projectTitle" class="form-label">Project Title</label>
                            <input type="text" class="form-control" id="projectTitle" maxlength="100" required>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <small class="text-muted" id="titleCharCounter">100 characters remaining</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="projectDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="projectDescription" rows="3" maxlength="250" required></textarea>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <small class="text-muted" id="descriptionCharCounter">250 characters remaining</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Technologies</label>
                            <div class="d-flex flex-wrap gap-2" id="technologiesContainer">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Add technology">
                                    <button class="btn btn-outline-secondary" type="button" onclick="addTechnology(this)">
                                        <i class="bi bi-plus-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="technologiesList" class="d-flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        <div class="mb-3">
                            <label for="githubLink" class="form-label">GitHub Link</label>
                            <input type="url" class="form-control" id="githubLink" placeholder="https://github.com/...">
                        </div>
                        <div class="mb-3">
                            <label for="demoLink" class="form-label">Live Demo Link</label>
                            <input type="url" class="form-control" id="demoLink" placeholder="https://...">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProject()">Save Project</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="confirmDeleteProjectModal" tabindex="-1" aria-labelledby="confirmDeleteProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteProjectModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this project?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteProjectButton">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Project Modal -->
    <div class="modal fade" id="editProjectModal" tabindex="-1" aria-labelledby="editProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProjectModalLabel">Edit Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProjectForm">
                        <div class="mb-3">
                            <label for="editProjectTitle" class="form-label">Project Title</label>
                            <input type="text" class="form-control" id="editProjectTitle" maxlength="100" required>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <small class="text-muted" id="editTitleCharCounter">100 characters remaining</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editProjectDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editProjectDescription" rows="3" maxlength="250" required></textarea>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <small class="text-muted" id="editDescriptionCharCounter">250 characters remaining</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Technologies</label>
                            <div class="d-flex flex-wrap gap-2" id="editTechnologiesContainer">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Add technology">
                                    <button class="btn btn-outline-secondary" type="button" onclick="addTechnologyEdit(this)">
                                        <i class="bi bi-plus-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="editTechnologiesList" class="d-flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        <div class="mb-3">
                            <label for="editGithubLink" class="form-label">GitHub Link</label>
                            <input type="url" class="form-control" id="editGithubLink" placeholder="https://github.com/...">
                        </div>
                        <div class="mb-3">
                            <label for="editDemoLink" class="form-label">Live Demo Link</label>
                            <input type="url" class="form-control" id="editDemoLink" placeholder="https://...">
                        </div>
                        <input type="hidden" id="editProjectId">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateProject()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo removal confirmation modal -->
    <div class="modal fade" id="confirmRemovePhotoModal" tabindex="-1" aria-labelledby="confirmRemovePhotoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmRemovePhotoModalLabel">Remove Profile Photo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to remove your profile photo? This action cannot be undone.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="confirmRemovePhoto()">Remove Photo</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .project-card {
            transition: transform 0.2s ease-in-out;
        }
        .project-card:hover {
            transform: translateY(-5px);
        }
        .technology-badge {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .technology-badge:hover {
            opacity: 0.8;
        }
        #socialLinksList .list-group-item {
            transition: all 0.2s ease-in-out;
            display: inline-block;
        }
        #socialLinksList .list-group-item:hover {
            transform: scale(1.05);
            background-color: #f8f9fa;
        }
    </style>

    <script src="{% static 'js/worker-profile-add-skill-modal.js' %}"></script>
    <script src="{% static 'js/worker-profile-edit-skill.js' %}"></script>
    <script src="{% static 'js/worker-profile-common.js' %}"></script>
    <script src="{% static 'js/worker-profile-edit-about-me.js' %}"></script>
    <script src="{% static 'js/worker-profile-social-links.js' %}"></script>
    <script>
        const locations = {{ locations_json|safe }};
        const initialCountry = "{{ user_data.country|escapejs }}";
        const initialCity = "{{ user_data.city|escapejs }}";
        console.log(initialCountry, initialCity);

        // Initialize country select
        function initializeCountrySelect() {
            const countrySelect = document.getElementById('countrySelect');
            if (!countrySelect) return;

            // Add countries to select
            Object.keys(locations).forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
            });

            // Set initial values from backend
            if (typeof initialCountry !== "undefined" && initialCountry) {
                countrySelect.value = initialCountry;
                updateCitySelect(initialCountry);
                const citySelect = document.getElementById('citySelect');
                if (citySelect && typeof initialCity !== "undefined" && initialCity) {
                    citySelect.value = initialCity;
                }
            }
        }

        // Update city select based on selected country
        function updateCitySelect(country) {
            const citySelect = document.getElementById('citySelect');
            if (!citySelect) return;

            // Clear existing options
            citySelect.innerHTML = '<option value="">Select City</option>';

            // Add cities for selected country
            if (country && locations[country]) {
                locations[country].forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            }
        }

        // Add event listener for country select
        document.addEventListener('DOMContentLoaded', function() {
            const countrySelect = document.getElementById('countrySelect');
            if (countrySelect) {
                countrySelect.addEventListener('change', function() {
                    updateCitySelect(this.value);
                });
                initializeCountrySelect();
            }
        });

        function updateLocationBadges() {
            const remoteCheck = document.getElementById('remoteCheck');
            const hybridCheck = document.getElementById('hybridCheck');
            const remoteBadge = document.getElementById('remoteBadge');
            const hybridBadge = document.getElementById('hybridBadge');
            const locationBadges = document.getElementById('locationBadges');

            locationBadges.style.display = 'flex';
            
            if (remoteCheck.checked) {
                remoteBadge.style.display = 'inline-block';
                remoteBadge.style.visibility = 'visible';
            } else {
                remoteBadge.style.display = 'none';
                remoteBadge.style.visibility = 'hidden';
            }
            
            if (hybridCheck.checked) {
                hybridBadge.style.display = 'inline-block';
                hybridBadge.style.visibility = 'visible';
            } else {
                hybridBadge.style.display = 'none';
                hybridBadge.style.visibility = 'hidden';
            }
        }

        function toggleEdit(field) {
            const content = document.getElementById(field + 'Content');
            const edit = document.getElementById(field + 'Edit');
            const editButtons = edit.querySelector('.edit-buttons');
            
            if (content.style.display !== 'none') {
                content.style.display = 'none';
                edit.style.display = 'block';
                if (editButtons) {
                    editButtons.classList.remove('d-none');
                }

                // Initialize location selects if editing location
                if (field === 'location') {
                    const countrySelect = document.getElementById('countrySelect');
                    const citySelect = document.getElementById('citySelect');
                    if (countrySelect && initialCountry) {
                        countrySelect.value = initialCountry;
                        updateCitySelect(initialCountry);
                        if (citySelect && initialCity) {
                            // Wait for city options to populate
                            setTimeout(function() {
                                citySelect.value = initialCity;
                            }, 0);
                        }
                    }

                    // Initialize remote/hybrid checkboxes
                    const remoteCheck = document.getElementById('remoteCheck');
                    const hybridCheck = document.getElementById('hybridCheck');
                    const remoteBadge = document.getElementById('remoteBadge');
                    const hybridBadge = document.getElementById('hybridBadge');

                    remoteCheck.checked = remoteBadge.style.display !== 'none';
                    hybridCheck.checked = hybridBadge.style.display !== 'none';
                    updateLocationBadges();
                }
            } else {
                content.style.display = 'block';
                edit.style.display = 'none';
                if (editButtons) {
                    editButtons.classList.add('d-none');
                }
            }
        }

        function cancelEdit(field) {
            const contentDiv = document.getElementById(`${field}Content`);
            const editDiv = document.getElementById(`${field}Edit`);
            const editIcon = contentDiv.closest('.d-flex').querySelector('.edit-icon');
            const editButtons = editIcon.nextElementSibling;
            
            contentDiv.style.display = 'block';
            editDiv.style.display = 'none';
            editIcon.classList.remove('d-none');
            editButtons.classList.add('d-none');

            if (field === 'location') {
                const remoteCheck = document.getElementById('remoteCheck');
                const hybridCheck = document.getElementById('hybridCheck');
                const remoteBadge = document.getElementById('remoteBadge');
                const hybridBadge = document.getElementById('hybridBadge');

                remoteCheck.checked = remoteBadge.style.display !== 'none';
                hybridCheck.checked = hybridBadge.style.display !== 'none';
                updateLocationBadges();
            }
        }

        function showToast(message, isSuccess = true) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.getElementById('customToast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastContainer.style.display = 'block';
            toast.className = `toast align-items-center text-bg-${isSuccess ? 'success' : 'danger'} border-0 d-flex justify-content-between`;
            toastMessage.textContent = message;
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            toast.addEventListener('hidden.bs.toast', function () {
                toastContainer.style.display = 'none';
            });
        }

        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 9) value = value.slice(0, 9);
            if (value.length > 6) {
                value = value.slice(0, 6) + ' ' + value.slice(6);
            }
            if (value.length > 3) {
                value = value.slice(0, 3) + ' ' + value.slice(3);
            }
            input.value = value;
        }

        function validatePhoneNumber(value) {
            return /^\d{3} \d{3} \d{3}$/.test(value);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const mobileInput = document.getElementById('mobileInput');
            if (mobileInput) {
                mobileInput.addEventListener('input', function() {
                    formatPhoneNumber(this);
                });
            }
        });

        async function saveEdit(field) {
            const content = document.getElementById(field + 'Content');
            const edit = document.getElementById(field + 'Edit');
            const editButtons = edit.querySelector('.edit-buttons');
            let value;
            let payload;

            if (field === 'location') {
                const countrySelect = document.getElementById('countrySelect');
                const citySelect = document.getElementById('citySelect');
                const remoteCheck = document.getElementById('remoteCheck');
                const hybridCheck = document.getElementById('hybridCheck');

                if (!countrySelect.value || !citySelect.value) {
                    showToast('Please select both country and city', false);
                    return;
                }

                value = {
                    country: countrySelect.value,
                    city: citySelect.value,
                    is_remote: remoteCheck.checked,
                    is_hybrid: hybridCheck.checked
                };
                payload = value;
            } else {
                const input = document.getElementById(field + 'Input');
                value = input.value;
                payload = {
                    field: field,
                    value: value
                };
            }

            try {
                const response = await fetch('/update-location', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': CSRF_TOKEN
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (response.ok) {
                    if (field === 'location') {
                        content.textContent = `${value.city}, ${value.country}`;
                        updateLocationBadges();
                    } else {
                        content.textContent = value;
                    }
                    edit.style.display = 'none';
                    content.style.display = 'block';
                    showToast('Profile updated successfully');
                } else {
                    showToast(data.error || 'Failed to update profile', false);
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                showToast('An error occurred while updating profile', false);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const remoteCheck = document.getElementById('remoteCheck');
            const hybridCheck = document.getElementById('hybridCheck');
            if (remoteCheck && hybridCheck) {
                updateLocationBadges();
            }

            // Set initial value for startsIn select
            const startsInSelect = document.getElementById('startsInSelect');
            const startsInContent = document.getElementById('startsInContent');
            if (startsInSelect && startsInContent) {
                startsInSelect.value = startsInContent.textContent.trim();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const profileImg = document.querySelector('.profile-img');
            const overlay = document.querySelector('.overlay');

            profileImg.parentElement.addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('profilePhotoModal'));
                modal.show();
            });

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                dropZone.classList.add('bg-light');
            }

            function unhighlight(e) {
                dropZone.classList.remove('bg-light');
            }

            dropZone.addEventListener('drop', handleDrop, false);
            fileInput.addEventListener('change', handleFileSelect, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            function handleFileSelect(e) {
                const files = e.target.files;
                handleFiles(files);
            }

            function handleFiles(files) {
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('imagePreview').src = e.target.result;
                            document.getElementById('previewContainer').style.display = 'block';
                            dropZone.style.display = 'none';
                        }
                        reader.readAsDataURL(file);
                    } else {
                        alert('Please select an image file.');
                    }
                }
            }
        });

        function resetUpload() {
            document.getElementById('fileInput').value = '';
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('dropZone').style.display = 'block';
        }

        function uploadPhoto() {
            const preview = document.getElementById('imagePreview');
            const profileImg = document.querySelector('.profile-img');
            
            // Convert the image to base64
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = preview.naturalWidth;
            canvas.height = preview.naturalHeight;
            ctx.drawImage(preview, 0, 0);
            const base64Image = canvas.toDataURL('image/jpeg');

            // Create form data
            const formData = new FormData();
            formData.append('image', base64Image);


            fetch('/profile-photo/add/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': CSRF_TOKEN
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Set the uploaded base64 image as the current profile photo
                    const allProfileImages = document.querySelectorAll('.profile-img');
                    allProfileImages.forEach(img => {
                        img.src = base64Image;
                    });
                    showToast('Profile photo updated successfully');
                    // Close modal and reset
                    const modal = bootstrap.Modal.getInstance(document.getElementById('profilePhotoModal'));
                    modal.hide();
                    resetUpload();
                } else {
                    showToast(data.error || 'Failed to update profile photo', false);
                }
            })
            .catch(error => {
                console.error('Error uploading photo:', error);
                showToast('An error occurred while uploading photo', false);
            })
            .finally(() => {
                // Reset button state
                uploadButton.disabled = false;
                uploadButton.innerHTML = originalText;
            });
        }

        function removeProfilePhoto() {
            // Show confirmation modal instead of removing directly
            const confirmModal = new bootstrap.Modal(document.getElementById('confirmRemovePhotoModal'));
            confirmModal.show();
        }

        function confirmRemovePhoto() {
            const profileImg = document.querySelector('.profile-img');
            profileImg.src = "{% static 'images/avatar.png' %}";
            
            //  PLACEHOLDER: Send request to remove photo
            fetch('/profile-photo/remove/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': CSRF_TOKEN
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('Profile photo removed successfully');
                } else {
                    showToast('Failed to remove profile photo', false);
                }
            })
            .catch(error => {
                console.error('Error removing profile photo:', error);
                showToast('An error occurred while removing profile photo', false);
            });

            // Close both modals
            const confirmModal = bootstrap.Modal.getInstance(document.getElementById('confirmRemovePhotoModal'));
            confirmModal.hide();
            const photoModal = bootstrap.Modal.getInstance(document.getElementById('profilePhotoModal'));
            photoModal.hide();
        }

        let projects = [
            {% for project in projects %}
            {
                id: {{ project.id }},
                title: "{{ project.title }}",
                description: "{{ project.description }}",
                technologies: {{ project.get_technologies|safe }},
                githubLink: "{{ project.github_link|default:'' }}",
                demoLink: "{{ project.demo_link|default:'' }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];
        let technologies = new Set();
        let projectToDelete = null;

        function addTechnology(button) {
            // Implementation of addTechnology function
        }

    </script>
{% endblock %}
